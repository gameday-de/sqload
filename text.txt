package main

import (
	"fmt"
	"regexp"
	"strings"
)

var QueryName = regexp.MustCompile(`-- query: `)
var QueryComment = regexp.MustCompile(`[ \t\n\r\f\v]*--[ \t\n\r\f\v]*(.*)$`)
var ValidQueryName = regexp.MustCompile(`^[a-zA-Z0-9_]+$`)

var sql = `
-- query: find_all_users
-- Find all users
SELECT * FROM uuser;

-- query: find_user_by_username
-- Find a user with the given username field
SELECT *
  FROM uuser
 WHERE username = %(username)s;

-- query: find_user_by_id
-- Find a user with the given uuser_id
SELECT *
  FROM uuser
 WHERE uuser_id = %(uuser_id)s;
`

func extractSQL(lines []string) string {
	sql := ""
	for _, line := range lines {
		if !QueryComment.MatchString(line) {
			sql = sql + line + "\n"
		}
	}
	return sql
}

func main() {
	queries := QueryName.Split(sql, -1)
	for i, query := range queries[1:] {
		fmt.Println(i, query)
		lines := strings.Split(strings.TrimSpace(query), "\n")
		extractedSql := extractSQL(lines[1:])
		fmt.Println("Extracted SQL:", extractedSql)
	}
}
